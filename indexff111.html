<!--Written for Firefox->
<html>
        <head>
            <style>
                
                #div {
                    width: 500px;
                    height: 70px;
                    padding: 10px;
                }
                #source {
                    width: 150px;
                    height: 20px;
                    padding:10px;
                    color: blue;
                    border: 1px solid black;
                }
                #target {
                    width: auto;
                    height: 70px;
                    padding: 10px;
                    border: 1px solid #aaaaaa;
                }
            </style>
            <script>
                //Firefox dsnt work with dataList.add, it works fien with setData()
                var datatype = [];
                var datatype_value = '';
                const uri1 = "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTtQ_NqOyPiB_Xwba8EgziR2cCpQd4zWm05qE33ns7WNynbxflY";
                const uri2 = "https://www.bmwjamaica.com/content/dam/bmw/common/all-models/m-series/m4-convertible/2017/images-and-videos/images/BMW-m4-convertible-images-and-videos-1920x1200-06.jpg.asset.1487344406677.jpg";
                const img_tag = '<img id="source "src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTtQ_NqOyPiB_Xwba8EgziR2cCpQd4zWm05qE33ns7WNynbxflY" ondragstart="dragstart_handler(event);" ondragend="dragend_handler(event);" draggable="true" />';
                
                function allowDrop(ev) {
                   ev.preventDefault();
                }

                function setdata(type){
                    if(type == 'text/plain'){
                        if( datatype.indexOf(type) == -1){
                            datatype.push(type);
                            //console.log(datatype);
                            document.getElementById("para2").innerHTML = datatype;
                        }
                        else
                            alert (" Datatype already exists");
                        
                    }
                    else if  (type == 'text/uri-list'){
                        if( datatype.indexOf(type) == -1){
                            datatype.push(type);
                            document.getElementById("para2").innerHTML = datatype;
                        }
                        else
                            alert (" Datatype already exists");
                        
                    }
                    else if (type == 'text/html'){
                        if( datatype.indexOf(type) == -1){
                            datatype.push(type);
                            document.getElementById("para2").innerHTML = datatype;
                        }
                        else
                            alert (" Datatype already exists");
                        
                    }
                }

                function drag(ev) {
                    console.log("dragStart");
                    var dataList = ev.dataTransfer.items;
                    
                    console.log('Default dataList',ev.dataTransfer.types);
                    console.log('types to be added:',datatype.length);

                    //Firefox dsnt work with dataList.add, it works fien with setData()
                    for(var i = 0; i< datatype.length; i++){
                        if(datatype[i] == 'text/plain') {
                            ev.dataTransfer.setData(datatype[i],uri1);
                            console.log('adding datatype', datatype[i],':',ev.dataTransfer.getData(datatype[i]));
                            }
                        else if(datatype[i] == 'text/uri-list'){
                            ev.dataTransfer.setData(datatype[i],uri2);
                            console.log('adding datatype', datatype[i],':',ev.dataTransfer.getData(datatype[i]));
                        }
                        else if (datatype[i] ==  'text/html'){
                            datatype_value = img_tag;
                            ev.dataTransfer.setData(datatype[i],img_tag);
                            console.log('adding datatype', datatype[i],':',ev.dataTransfer.getData(datatype[i]));
                        }
                        
                        console.log("datalist after adding",ev.dataTransfer.items, ev.dataTransfer.types);
                    }

                }

                function drop(ev) {
                    console.log('drop');
                    ev.preventDefault();
                    
                    var data = ev.dataTransfer.items;
                    for (var i = 0; i < data.length; i++) {
                        console.log(data[i].kind,data[i].type);
                        //document.getElementById("target").innerHTML = data[i].kind + ' '+data[i].type + ' ';

                        if ((data[i].kind == 'string') && (data[i].type.match('^text/plain'))) {
                            data[i].getAsString(function (s){
                                var a=document.getElementById("target").innerHTML;
                                if(a!== null)
                                    console.log('notnull',a);
                                document.getElementById("target").innerHTML = a+'  '+s;
                            });
                        } 
                        if ((data[i].kind == 'string') && (data[i].type.match('^text/uri-list'))) {
                            data[i].getAsString(function (s){
                                var a=document.getElementById("target").innerHTML;
                                document.getElementById("target").innerHTML = a+'  '+s;
                            });
                        } else if ((data[i].kind == 'string') && (data[i].type.match('^text/html'))) {
                            data[i].getAsString(function (s){
                                var a=document.getElementById("target").innerHTML;
                                document.getElementById("target").innerHTML = a+'  '+s; 
                            });
                        }
                    }
                }

            </script>
        </head>
        <body>
                <div>
                <p id= "source" draggable="true" ondragstart="drag(event)">Drag data</p>
                </div>
                <div>
                    <br>
                    <p>Add Datatypes:</p>
                    <button onclick="setdata('text/plain')">text/plain : url</button>                
                    <button onclick="setdata('text/uri-list')">text/uri-list : url</button>
                    <button onclick="setdata('text/html')">text/html : img tag</button>
                </div>
                <br>
                <div><p>Datatypes List: </p><p id="para2"></p></div>
                <br><br><p>Drop Here:</p><div id="target" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        </body>
    </html>
